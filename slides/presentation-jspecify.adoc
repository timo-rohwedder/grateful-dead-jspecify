:revealjs_theme: league
// beige, black, league, night, serif, simple, sky, solarized, white
:docinfo: private
:source-highlighter: highlight.js
:highlightjs-theme: https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/atom-one-dark.min.css
:customcss: custom.css

= JSpecify

[%step]
Standard Annotations for Java Static Analysis

[transition=none-out]
== Das Problem
[%step]
[source,java]
----
class Customer {
    private Address shippingAddress;

    public Address getShippingAddress() {
        return shippingAddress;
    }
}
----
[%step]
[source,java]
----
public static void main(String[] args) {
    Customer customer = EventConsumer.getCustomer();
    printAddressLabel(customer.getShippingAddress());
}
----
[%step]
[source,java]
----
static void printAddressLabel(Address shippingAddress) {
    System.out.println(shippingAddress.getAddressLine());
}
----

[transition=none]
== Das Problem
[.stretch]
image::img/nuclear-explosion.gif[size=cover]

[.custom-code]
[source, console]
----
Exception in thread "main" java.lang.NullPointerException:
Cannot invoke "com.example.gratefuldeadjspecify.without.Address.getAddressLine()" because "shippingAddress" is null
	at com.example.gratefuldeadjspecify.without.PrintAddressLabelApp.printAddressLabel(PrintAddressLabelApp.java:12)
	at com.example.gratefuldeadjspecify.without.PrintAddressLabelApp.main(PrintAddressLabelApp.java:8)
----

== Kennt jeder - High Five üôè
[%step]
Eine NullPointerException haben vermutlich alle schon einmal in unterschiedlichsten Programmiersprachen verantwortet.

[%step]
"Billion-Dollar Mistake"
-- Tony Hoare, referring to his 1965 introduction of the null reference in the ALGOL W programming language

[%notitle]
== Null Problemo
[%step]
Viele haben sich dar√ºber den Kopf zerbrochen
[%step]
und _unabh√§ngig_ voneinander gesagt:
[%step]
image::img/null-problemo.jpg[size=cover]

== Der Versuch das Problem zu l√∂sen
[.stretch]
[source]
----
android.support.annotation.NonNull
androidx.annotation.NonNull
androidx.annotation.RecentlyNonNull
com.android.annotations.NonNull
edu.umd.cs.findbugs.annotations.NonNull
io.reactivex.annotations.NonNull
io.reactivex.rxjava3.annotations.NonNull
io.micrometer.core.lang.NonNull
jakarta.annotation.Nonnull
javax.annotation.Nonnull
org.checkerframework.checker.nullness.compatqual.NonNullDecl
org.checkerframework.checker.nullness.compatqual.NonNullType
org.checkerframework.checker.nullness.qual.NonNull
org.eclipse.jdt.annotation.NonNull
org.jetbrains.annotations.NotNull
org.jmlspecs.annotation.NonNull
org.netbeans.api.annotations.common.NonNull
org.springframework.lang.NonNull
org.codehaus.commons.nullanalysis.NotNull
reactor.util.annotation.NonNull
----

[%notitle]
== Wir reden hier nicht von Bean Validation
:icons: font

[%step]
IMPORTANT: Es geht hier *nicht* um Validierung

[%step]
Also `@NotNull` und andere Validierung-Annotationen aus `jakarta.validation.*` (`@Null`, `@Positive`, `@Min`, `@Max` ...)

[.columns]
== üë∑ Jetzt aber wirklich üë∑
[.column]
* EISOP Team _(EISOP)_
* Google _(Android, Error Prone, Guava)_
* JetBrains _(Kotlin, IntelliJ IDEA)_
* Meta _(Infer)_
* Microsoft _(Azure SDK for Java)_
* Oracle _(OpenJDK)_

[.column]
* PMD Team _(PMD)_
* Sonar _(SonarQube, SonarCloud, SonarLint)_
* Square _(various)_
* Uber _(NullAway)_
* Broadcom _(Spring)_

== JSpecify Annotations
[.r-fit-text]
[%step]
* `@NonNull` +
Feld, Parameter oder R√ºckgabewert kann nicht `null` sein
* `@Nullable` +
Feld, Parameter oder R√ºckgabewert kann `null` sein.
* `@NullMarked` +
Alle Felder, Parameter und R√ºckgabewerte (an  Package, Typ, Methode oder Konstruktor) k√∂nnen nicht `null` sein.
* `@NullUnmarked` +
hebt `@NullMarked` auf

== JSpecify im Code
[.stretch]
[source,java,%linenums,highlight="0|1|3|5|16|1,3,5,16|0"]
----
@NullMarked
class Customer {
    @Nullable Address shippingAddress;

    public @Nullable Address getShippingAddress() {
        return shippingAddress;
    }
}

public static void main(String[] args) {
    Customer customer = EventConsumer.getCustomer();
    printAddressLabel(customer.getShippingAddress());
}

static void printAddressLabel(
        @Nullable Address shippingAddress) {
    System.out.println(shippingAddress == null
        ? "no shipping address"
        : shippingAddress.getAddressLine());
}
----

== Collections
[%step]
[source,java]
----
// Die Liste `tags` kann null sein
@Nullable
List<String> tags;
----
[%step]
[source,java]
----
// Die Elemente in der Liste k√∂nnen null sein
List<@Nullable String> tags;
----
[%step]
[source,java]
----
// Liste und Elemente in der Liste k√∂nnen null sein
@Nullable
List<@Nullable String> tags;
----

== Arrays
[%step]
[source,java]
----
// Das Array `tags` kann null sein
@Nullable
String[] tags;
----
[%step]
[source,java]
----
// Die Elemente im Array k√∂nnen null sein
String @Nullable[] tags;
----
[%step]
[source,java]
----
// Array und Elemente im Array k√∂nnen null sein
@Nullable
String @Nullable[] tags;
----

== üìè Statische Codeanalyse in der IDE

== üìê Statische Codeanalyse beim Build
[%step]
mit

[%step]
* errorprone +
https://github.com/tbroyer/gradle-errorprone-plugin
* NullAway +
https://github.com/tbroyer/gradle-nullaway-plugin

== ü§© Wer ist drauf?
[%step]
* IntelliJ
* Spring ab Spring Framework 7.x, Spring Boot 4.x
* JUnit 6
* _Lombok_

== üå∂Ô∏è Lombok
[%step]
Lombok kann `@NonNull` und `@Nullable` in den generierten Lombok generierten Code einf√ºgen.

[%step]
[source,properties]
----
lombok.addNullAnnotations=jspecify
----

== üìö Quellen
[.r-fit-text]
* JSpecify +
https://jspecify.dev
* heise: Null Problemo: Bessere Null-Checks in Java mit JSpecify +
https://www.heise.de/blog/Null-Problemo-Bessere-Null-Checks-in-Java-mit-JSpecify-9820606.html
* JSpecify and NullAway: A fresh take on nullsafety in the Java world +
https://michael-simons.eu/p/jspecify-and-nullaway-a-fresh-take-on-nullsafety-in-the-java-world.html
* Dan Vega: Stop NullPointerExceptions Before Production with Spring Boot 4's Null Safety +
https://www.danvega.dev/blog/spring-boot-4-null-safety

== Danke! ü§ó Fragen?
